#linux内核简介

![](images/liunx02.png)

从上图开始介绍linux内核

最内层是硬件，最外层是我们常用的各种应用，比如firefox浏览器。硬件是我们的物质基础，任何计算机相关的东西都是，而应用时我们为之奋斗的目标，但是怎么将硬件和应用结合起来，还得需要周折一番。

- (1)硬件

linux安装时候所有可能的物理设备，例如：CPU、内存、硬盘、网络、硬件等等

- (2)内核

是操作系统的灵魂，它负责管理磁盘上的文件、内存，负责启动并运行程序，负责从网络上接收和发送数据包等等，内核实际上是抽象的资源操作到具体的硬件操作细节之间的接口，是外界与硬件交互的桥梁。

- (3)系统调用

为了方便调用内核，将内核封装成系统调用。系统调用像c语言函数，你可以在程序中直接调用（可以理解为汉字中的笔画），系统调用对外展现的是一堆清晰的接口。一个个操作系统的功能可以看做是系统调用函数的组合（类似一个汉字是由很多笔画组成的）。

$man 2 syscalls 查看所有系统调用

![](images/linux03.png)

- (4)库函数

由于系统调用函数用起来比较繁琐，一个分配内存空间操作，需要多个系统调用。所有linux定义了一些库函数，比如内存分配函数malloc()。使用库函数对机器来说没有效率上的优势，但是封装性更好了，便于程序员使用。库函数类似于汉字中的偏旁部首，它由笔画组成（系统函数）

- (5)shell

shell是一个命令解释器，当输入ls –l时，会在默认路径下找到/bin/ls，执行该文件并附带参数-l。shell有很多种，最常用的是bash和csh

- (6)应用

从上图可以发现，应用时一个程序，可以直接调用系统函数，也可以调用库函数，运行shell script。这些应用可以由多种语言开发，满足计算机的各种需求。用户应用程序是运行在linux操作系统最高层的庞大软件集合，当一个用户程序在操作系统上运行时，它在操作系统中是一个进程。

Linux分为：用户空间和内核空间。内核空间和用户空间是程序执行的两种不同的状态，通过系统调用和硬件中断能够完成从用户空间到内核空间的转移。Linux利用内核实现了软硬件的对话。

###linux内核架构图

从程序员的角度来讲，操作系统的内核提供了一个与计算机硬件等价的扩展或虚拟的计算平台。抽象了许多硬件的细节，程序可以以某种统一的方式进行数据处理，程序员可以避开许多硬件细节。普通用户则把操作系统看成是一个资源管理者。

Linux以统一的方式支持多任务，而这种方式对用户进程是透明的，每一个进程运行起来就好像只有他一个进程在计算机上运行一样，独占内存和其他硬件的资源，而实际上，内核在冰法的运行多个进程，并且能够让几个进程公平合理的使用硬件资源，也能使各进程之间互不干扰安全的运行。

		GNU/Linux操作系统简单架构

![](images/linux04.png)

备注：IPC进程间通。IPC(Inter-Process Communication)是共享"命名管道"的资源，它是为了让进程间通信而开放的命名管道，
        
通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问

GUN C和ANSI C函数库区别：libc是linux下的ANSIC的函数库，而glibc是linux下的GUN C的函数库，基本上两者没什么差别

		Linux操作系统详细架构
		
![](images/linux05.png)

###linux内核的抽象结构

Linux内核主要由五个子系统组成：进程调度，内存管理，虚拟文件系统，网络接口，进程间通信。

这里先简单介绍下各个的功能，后边会详细介绍

- (1)进程调度

控制进程对cpu的访问。当需要选择下一个进程运行时，由调度程序选择最值得运行的程序。可运行进程实际上是仅等待CPU资源的进程，如果某个进程在等待其它资源，则该进程是不可运行进程。Linux使用了比较简单的基于优先级的进程调度算法选择新的进程。

- (2)内存管理

允许多个进程安全的共享主内存区域。Linux 的内存管理支持虚拟内存，即在计算机中运行的程序，其代码，数据，堆栈的总量可以超过实际内存的大小，操作系统只是把当前使用的程序块保留在内存中，其余的程序块则保留在磁盘中。必要时，操作系统负责在磁盘和内存间交换程序块。内存管理从逻辑上分为硬件无关部分和硬件有关部分。硬件无关部分提供了进程的映射和逻辑内存的对换；硬件相关的部分为内存管理硬件提供了虚拟接口。

- (3)虚拟文件系统

隐藏了各种硬件的具体细节，为所有的设备提供了统一的接口，VFS提供了多达数十种不同的文件系统。虚拟文件系统可以分为逻辑文件系统和设备驱动程序。逻辑文件系统指Linux所支持的文件系统，如ext2,fat等，设备驱动程序指为每一种硬件控制器所编写的设备驱动程序模块。

![](images/linux06.png)

- (4)网络接口

提供了对各种网络标准的存取和各种网络硬件的支持。网络接口可分为网络协议和网络驱动程序。网络协议部分负责实现每一种可能的网络传输协议。网络设备驱动程序负责与硬件设备通讯，每一种可能的硬件设备都有相应的设备驱动程序。

- (5)进程间通信

支持进程间各种通信机制。

		Linux内核子系统及其之间的关系

![](images/linux07.png)

各个系统之间的关系

进程调度与内存管理的关系：这两个子系统相互依赖。程序要运行必须为之创建进程，而创建进程的第一件事情就是要将程序和数据装入内存。

进程间通信与内存管理的关系：进程间通信子系统要依赖内存管理支持共享内存通信机制，这种机制允许两个进程除了拥有自己的私有内存，还可存取共同的内存区域。

虚拟文件系统与网络接口的关系：虚拟文件系统利用网络接口支持网络文件系统（NFS），也利用内存管理支持RAMDISK设备

内存管理与虚拟文件系统的关系：内存管理利用虚拟文件系统支持交换，交换进程（swapd）定期的由调度程序调度，这也是内存管理依赖于进程调度的唯一原因。当一个进程存取的内存映射被换出时，内存管理向文件系统发出请求，同时，挂起当前正在运行的进程。

注意：除了上图之外，内核的所有子系统还要依赖一些共同的资源，譬如：分配和释放内存空间的过程，打印警告或错误信息的过程，系统的调试例程等。

###linux内核启动

###linux内核代码架构图



